# ä»¿VueRouterå†™å°ç¨‹åºçš„è·¯ç”±å®ˆå«

å°ç¨‹åºä»£ç ç‰‡æ®µ: [wechatide://minicode/80h6lemI7c3Y](wechatide://minicode/80h6lemI7c3Y)

## æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹

**getCurrentPages()**ã€**Object.defineProperty()**

## åŸºæœ¬æè¿°

æœ¬åŠŸèƒ½å¯ä»¥è®©å°ç¨‹åºå¼€å‘è€…æœ‰å¯¹è·¯ç”±è·³è½¬è¿›è¡Œæ§åˆ¶çš„èƒ½åŠ›ï¼Œè·³è½¬å‰å¯ä»¥åšä¸€äº›åˆ¤æ–­ï¼Œæ¯”å¦‚ç”¨æˆ·çš„æˆæƒä¿¡æ¯ä¹‹ç±»çš„ï¼ˆå…·ä½“çœ‹ä¸šåŠ¡éœ€æ±‚ï¼‰ï¼Œåœ¨è·³è½¬åå¯èƒ½ä¸»è¦æ˜¯ä¸€äº›æ—¥å¿—æˆ–åŸ‹ç‚¹å·¥ä½œï¼ˆå…·ä½“çœ‹ä¸šåŠ¡éœ€æ±‚ï¼‰

<!-- more -->

## æ•ˆæœå›¾

åˆåˆ°äº†æ¿€åŠ¨äººå¿ƒçš„æ— å›¾è¨€diaoç¯èŠ‚
![](./pic/liteRouter.gif)

## ä½¿ç”¨æ–¹æ³•

ä»£ç å¯ä»¥ç›´æ¥æ‰“å¼€ä¸Šé¢çš„ä»£ç ç‰‡æ®µçœ‹åˆ°ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨è·¯ç”±å®ˆå«çš„ä»£ç 

	// app.js
	// å¼•ç”¨è¿™ä¸ªæ–¹æ³•æ¥ä¿®æ”¹åŸç”Ÿçš„navigateTo
	import extraNavigateTo from './extraNavigateTo.js'
	
	// æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰beforeæ–¹æ³•
	const before = function(from, to, next) {
	  if (to.path === '/index/open' && !wx.getStorageSync('auth')) {
	    next({
	      url: '/index/close'
	    })
	  } else {
	    // è¦æ˜¾ç¤ºè°ƒç”¨next()æ–¹æ³•
	    next()
	  }
	}
	
	// æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰afteræ–¹æ³•
	const after = function(path) {
	  console.log('after', path)
	}
	
	App({
	  onLaunch: function() {
	    // æµ‹è¯•ç”¨
	    wx.setStorageSync('auth', false)
	
	    // ä¿®æ”¹navigateTo
	    extraNavigateTo(before, after)
	  }
	})
	
é€šè¿‡çœ‹ä»£ç å¯ä»¥å‘ç°åªè¦åœ¨å°ç¨‹åºçš„`onLaunch`ç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œ`extraNavigateTo(before, after)`è¿™ä¸ªè¯­å¥å°±è¡Œäº†ï¼Œå…·ä½“è§£é‡Šä¸‹beforeå’Œafterçš„å…¥å‚

before:Function

åå­— | ç±»å‹ | è¯´æ˜
---- | --- | ---
from | string | è·¯ç”±è·³è½¬è°ƒç”¨çš„é¡µé¢è·¯å¾„
to | object | é‡Œé¢æœ‰ä¸‰ä¸ªå­—æ®µ `fullPath,path,query`é¡¾åæ€ä¹‰ï¼ˆæˆ‘å°±æ‡’å¾—è§£é‡Šäº†ğŸ˜‚ï¼‰
next | function | å½“ç”¨æˆ·è°ƒç”¨nextä¹‹åï¼Œå°±ç›¸å½“ä¸é‡å®šå‘ï¼Œnextæ¥å—çš„å‚æ•°å’Œwx.navigateToå…¥å‚ä¸€è‡´

after:Function

åå­— | ç±»å‹ | è¯´æ˜
---- | --- | ---
path | string | è·¯ç”±è·³è½¬åçš„é¡µé¢è·¯å¾„

## å®ç°åŸç†

å®ç°çš„æ ¸å¿ƒä»£ç å°±æ˜¯åœ¨`extraNavigateTo.js`æ–‡ä»¶ä¸­ï¼Œä¸»è¦æ˜¯é€šè¿‡`Object.defineProperty`æ–¹æ³•å¯¹`wx`å¯¹è±¡çš„`navigateTo`æ–¹æ³•é‡å†™ï¼ˆå› ä¸ºç›´æ¥èµ‹å€¼æ˜¯ä¸æˆåŠŸçš„:`wx.navigateTo = function(){}`ï¼‰

å¦å¤–`getCurrentPage`ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„æ–¹æ³•ï¼Œæ³¨æ„è¿™ä¸ªæ˜¯æ²¡æœ‰wxåç¼€çš„ï¼Œè¯´æ˜å°ç¨‹åºè¿˜æ˜¯æœ‰å…¨å±€å˜é‡ä¸”è¿™ä¸ªå…¨å±€å˜é‡è¿˜åŒ…æ‹¬`wx`,`getCurrentPage`æ–¹æ³•åœ¨å°ç¨‹åºæ–‡æ¡£ä¸­ä¹Ÿä»‹ç»çš„å¾ˆæ¸…æ¥šæ˜¯å¯ä»¥è·å–å½“å‰é¡µé¢æ ˆçš„ï¼Œé€šè¿‡é¡µé¢æ ˆè¿˜å¯ä»¥æ‹¿åˆ°ä»»ä½•ä¸€ä¸ªæ´»åŠ¨é¡µé¢çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥å¯ä»¥å‘æŒ¥æƒ³è±¡åŠ›æä¸€äº›éªšæ“ä½œï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥`console`è¯•è¯•

## ä¸è¶³

- ç”±äºæ˜¯å¯¹wx.navigateToçš„æ”¹å†™ï¼Œæ‰€ä»¥å¦‚æœæ˜¯ç”¨`navigate`ç»„ä»¶åˆ™ä¸ç”Ÿæ•ˆ
- è¿™ä¸ªè™½ç„¶æ˜¯ä»¿vue-routerï¼Œä¸è¿‡å…¶å®å¾ˆä¸ä¸€æ ·ï¼Œæ¯•ç«Ÿvue-routeræ˜¯ç›‘å¬urlï¼Œè¿™ä¸ªåªæ˜¯åœ¨è°ƒç”¨å‰åšä¸€äº›ä¸œè¥¿


## æœ€å

å¦‚æœå…³äºæ­¤åŠŸèƒ½æˆ–è€…å…¶ä»–å…³äºå°ç¨‹åºçš„ç–‘é—®ï¼Œæ¬¢è¿å’Œæˆ‘äº¤æµè®¨è®º [ljybill@aliyun.com](ljybill@aliyun.com)
